<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Custom rich text for PDP</title>
    <link rel="stylesheet" href="https://contentful.github.io/ui-extensions-sdk/cf-extension.css">
    <script src="https://contentful.github.io/ui-extensions-sdk/cf-extension-api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jodit@latest/build/jodit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@contentful/app-sdk@4"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jodit@latest/build/jodit.min.css">
</head>

<body>
    <textarea id="editor"></textarea>
    <script>
        var initialize = function () {
            const editor = Jodit.make("#editor", {
				height: 680,
                buttons: "bold,italic,underline,strikethrough,eraser,ul,ol,image,cut,copy,paste,selectall,hr,table,link,symbols,indent,outdent,left",
                createAttributes: {
                    ul: function (ul) {
                        ul.classList.add('custom-ul');
                    }
                },
                controls: {
                    ul: {
                        list: Jodit.atom({
                            default: 'Default',
                            circle: 'Circle',
                            square: 'Square',
                            cross: 'Cross',
                            tick: 'Tick',
                            red_cross: 'Red Cross',
                            green_tick: 'Green Tick',
                        }),

                        exec(editor, current, control) {
                            var overrideCSS = {
                                "tick": { "list-style-type": "none", "background-image": "url(https://images.ctfassets.net/9wtva4vhlgxb/4QVmTZX9ProyZSGSsWFR5a/be34b5ada5fa6fb20b4b75a35f898376/defaultTick.svg)", "background-repeat": "no-repeat" },
                                "cross": { "list-style-type": "none", "background": "url(https://images.ctfassets.net/9wtva4vhlgxb/57Bs6N8rYXw2UTNccxkU04/69bafea88f19d0fa768f06978a75674e/Icon.svg)", "background-repeat": "no-repeat" },
                                "red_cross": { "list-style-type": "none", "background-image": "url(https://images.ctfassets.net/9wtva4vhlgxb/7JVksVLOtNcik34xICsTz1/3352b6f249c00a5c8ee4a75a9b9f63ac/redCross.svg)", "background-repeat": "no-repeat" },
                                "green_tick": { "list-style-type": "none", "background-image": "url(https://images.ctfassets.net/9wtva4vhlgxb/3imAMwO9ZIKjDAxHwIZTbg/c2f7567966336f261e39c18ccfdd1346/greenTick.svg)", "background-repeat": "no-repeat"}
                            };
                            var value = control.control.name;
                            var styles;
                            if (Object.keys(overrideCSS).includes(value)) {
                                styles = overrideCSS[value];
                            } else {
                                styles = { "list-style-type": value };
                            }

                            editor.s.commitStyle({
                                element: 'ul',
                                attributes: {
                                    style: styles,
                                    class: value
                                }
                            });
                            editor.setEditorValue();
                        }
                    }
                }
            });
			return editor;
        }
        var cfExt = window.contentfulExtension || window.contentfulWidget;
        cfExt.init(extension => {
            extension.window.updateHeight(700);
            const select = document.getElementById('editor');
            var editor = initialize();
            const value = extension.field.getValue();
			if(value) editor.s.insertHTML(value);
            // send changes to the Contentful web app
            select.addEventListener('change', event => {
                extension.field.setValue(event.target.value);
            });
        });

    </script>
</body>

</html>